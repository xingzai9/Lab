<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>修改个人信息</title>
    <!--引入jquery-->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.2/dist/jquery.min.js"></script>
    <script rel="stylesheet" type="text/javascript" src="../js/jquery-3.4.1.js"></script>
    <!--动态-->
    <link rel="stylesheet" href="../layui/css/layui.css">
    <script src="../layui/layui.js"></script>
    <link rel="stylesheet" type="text/css" href="../css/login.css">
    <!--静态调试-->
    <link rel="stylesheet" type="text/css" href="../../static/layui/css/layui.css">
    <script type="text/javascript" src="../../static/layui/layui.js"></script>
    <link rel="stylesheet" type="text/css" href="../../static/css/login.css">
     <style type="text/css">
    .layui-form-select {
			width: 800px;
			/*height:60px;*/
	}
	.layui-form-item .layui-input {
    		width: 800px;
	}
    </style>  
</head>
<body>


<div class="layui-layout layui-layout-admin">
    <div class="layui-header layui-bg-cyan">
        <div class="layui-logo layui-hide-xs layui-bg-cyan">实验室管理系统</div>
        <!-- 头部区域（可配合layui 已有的水平导航） -->
        <ul class="layui-nav layui-layout-left layui-bg-cyan">
            <!-- 移动端显示 -->
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left layui-bg-cyan"></i>
            </li>
            <li class="layui-nav-item layui-hide-xs layui-bg-cyan layui-this"><a href="#" th:href="@{/stu/toModifyInfo}">个人信息</a></li>
            <li class="layui-nav-item layui-hide-xs layui-bg-cyan "><a href="#" th:href="@{/stu/toMyTeacher}">我的老师</a>
            </li>
            <li class="layui-nav-item layui-hide-xs layui-bg-cyan "><a href="#" th:href="@{/stu/toReserve}">预约实验</a></li>
<!--            <li class="layui-nav-item layui-hide-xs layui-bg-cyan "><a href="#" th:href="@{stu/booking/bookingInfo}"></a></li>-->
            <span class="layui-nav-bar"></span></ul>
        <ul class="layui-nav layui-layout-right layui-bg-cyan">
            <li  id="username" class="layui-nav-item layui-hide layui-show-md-inline-block">
                <!--                <a id="username" href="javascript:;" th:href="@{/stu/toModifyInfo}"></a>-->
            </li>
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;" th:href="@{/logout}">
                    退出
                    <i class="layui-icon layui-icon-down layui-nav-more"></i></a>
                <dl class="layui-nav-child layui-anim layui-anim-upbit">
                    <dd><a href="">Your Profile</a></dd>
                    <dd><a href="">Settings</a></dd>
                    <dd><a href="">Sign out</a></dd>
                </dl>
            </li>
            <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect="">
                <a href="javascript:;">
                    <i class="layui-icon layui-icon-more-vertical"></i>
                </a>
            </li>
            <span class="layui-nav-bar" style="left: 165.913px; width: 0px; opacity: 0; top: 56px;"></span></ul>
    </div>

    <div class="layui-side layui-bg-green">
        <div class="layui-side-scroll layui-bg-green">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree layui-bg-green">
                <li class="layui-nav-item">
                    <div class="layui-input-block">
                        <button id="changePassword"  onclick="changePassword()" style="align-self: flex-start" type="button"  class="layui-btn layui-btn-danger" lay-submit lay-filter="changePassword">修改密码</button>
                    </div>
                </li>
<!--                <li class="layui-nav-item"><a href="#" th:href="@{/admin/booking/bookingTimeInfo}">预约时间管理</a></li>-->

                <span class="layui-nav-bar"></span></ul>
        </div>
    </div>

    <div class="layui-body">
        <!-- 内容主体区域 -->
            <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
              <legend align="center">个人信息</legend>
            </fieldset>
        <div class="layui-container" style="margin-top: 30px" align="left" >
           	<h1>个人信息</h1>
          </div>
        <div class="layui-row " align="left">
        	<div class="layui-container" style="margin-top:60px ;">
		<form class="layui-form">
		  <div class="layui-form-item">
		    <label class="layui-form-label">学号</label>
		    <div class="layui-input-block">
		      <input type="text" id="stu_num" name="stu_num" class="layui-input" disabled>
		    </div>
		  </div>
		  
		  <div class="layui-form-item">
		    <label class="layui-form-label">姓名</label>
		    <div class="layui-input-block">
		      <input type="text" id="stu_name" name="stu_name" class="layui-input">
		    </div>
		  </div>

            <div class="layui-form-item">
                <label class="layui-form-label">学院</label>
                <div class="layui-input-block">
                    <select id="department" name="department" lay-verify="required">
                        <!--<option value=""></option>
                        <option value="0">计算机</option>
                        <option value="1">机械</option>
                        <option value="2">能动</option>
                        <option value="3">经管</option>-->
                    </select>
                </div>
            </div>
		  
		  <div class="layui-form-item">
		    <label class="layui-form-label">班级</label>
		    <div class="layui-input-block">
		      <input type="text" id="stu_class" name="stu_class" class="layui-input" >
		    </div>
		  </div>
		  
		  <div class="layui-form-item">
		    <label class="layui-form-label">邮箱号</label>
		    <div class="layui-input-block">
		      <input type="text" id="e_mail" name="e_mail" class="layui-input">
		    </div>
		  </div>
		  
		   	<div class="layui-form-item">
		    	<label class="layui-form-label">性别</label>
                <div class="layui-input-block">
                    <input type="text" id="gender" name="gender" class="layui-input">
                </div>

        	</div>
        	
		  <div class="layui-form-item">
		    <div class="layui-input-block">
		      <button id="submit" type="button" class="layui-btn" lay-submit lay-filter="formDemo">确认修改</button>
		    </div>

		  </div>
		  
		</form>
	 </div>
	</div>
    </div>
</div>
<!--课程表-->
<script>
//Demo
    layui.use(['form','table','layer'], function(){
          var form = layui.form;
          var table = layui.table;
          var layer = layui.layer;
          var $ = layui.jquery;
			  //监听提交
          window.changePassword = function() {
              layer.open({
                  type: 2,  //可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                  title: ['修改密码', 'font-size:18px; color:red;'],//数组第二项可以写任意css样式；如果你不想显示标题栏，你可以title: false
                  area: ['500px','300px'],
                  content: "http://localhost:8080/stu/toChangePassword",
                  // cancel: function(index, layero){
                  //     // if(layer.confirm('确定要关闭么')){ //只有当点击confirm框的确定时，该层才会关闭
                  //     //     layer.close(index);
                  //     // }
                  //     return false;
                  // },
                  yes: function(index){

//当点击‘确定'按钮的时候，获取弹出层返回的值
                      window.location.href = ("http://localhost:8080/logout");

//                       var res = window["layui-layer-iframe" + index].callbackdata();
//
// //打印返回的值，看是否有我们想返回的值。
//
//                       console.log("llll",res);
//
// //最后关闭弹出层

                      layer.close(index);
                  }
                  // end:function (){
                  //     window.location.href = ("http://localhost:8080/logout");
                  // }
              });
          }

          $.getJSON("http://localhost:8080/stu/getSession",function(d){
                console.log("session"+d.data)
                var username = d.data
                var str = "<a href='/stu/toModifyInfo' >欢迎用户" + username + "</a>";
                $('#username').html(str);
                $("#stu_num").val(username)
                $.getJSON("http://localhost:8080/labManager/getStudentById",{stu_num:username},function(d){
                        console.log(d)
                      $("#stu_num").val(d.data.stu_num);
                      $("#stu_name").val(d.data.stu_name);
                      $("#department").val(d.data.stu_department);
                      $("#e_mail").val(d.data.e_mail);
                      $("#stu_class").val(d.data.stu_class);
                      $("#gender").val(d.data.stu_gender==true?"男":'女')
              })
          })


            $.getJSON("http://localhost:8080/getDepartmentList",function(d){

                if(d.status == 1){
                    layer.msg(d.msg);
                }
                else{
                    var list = d.data;
                    // var str = "<option value=''></option>";
                    var str = ""
                    for(var i=0;i<list.length;i++){
                        str += "<option value=\"" + list[i]+"\">" + list[i] + "</option>";
                    }

                    $("#department").html(str);
                    form.render("select");
                }
            })


		  form.on('submit(formDemo)',function(data){
		  	layer.confirm("是否更改？",{icon:3,title:"提示"},function(index){

		  		console.log(data);
				$.getJSON("http://localhost:8080/labManager/updateStudent",
                    {
                        id:null,
                        stu_name:data.field.stu_name,
                        stu_num:data.field.stu_num,
                        stu_class:data.field.stu_class,
                        department:data.field.department,
                        gender:data.field.gender=='男'?true:false,
                        e_mail:data.field.e_mail
                    },
                    function(d){
					    if(d.status == 0){//成功
                            layer.msg("修改成功")
					        layer.close(index);
					    }
                        else{
                            console.log(d.msg);
                            layer.close(index);
                        }
					});
	  			});
		  	});
		});
</script>

</body>
</html>